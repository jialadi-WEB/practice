<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/index.css">
</head>

<body>
  <div class="box clearfix">
    <div class="item">
      <img src="./img/1.jpg" alt="">
      <P>Sunset Lake</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/2.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/3.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/4.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/5.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/6.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/7.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/8.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/9.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/10.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/11.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/12.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/13.jpg" alt="">
      <P>Sun Flowers</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/14.jpg" alt="">
      <P>Flowers</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/15.jpg" alt="">
      <P>Alone</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/1.jpg" alt="">
      <P>Sunset Lake</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/2.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/3.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/4.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/5.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/4.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>
    <div class="item">
      <img src="./img/5.jpg" alt="">
      <P>Bridge to Heaven</P>
      <div class="text">
        <p>A peaceful sunset view ...</p>
        <p>by j osborn</p>
      </div>
    </div>

  </div>
  <script>
    // 每行显示5个图片，每个图片的宽度都是204，高度是不一样的
    /**
     * 定位之后设置top和left
     * 
     * left = (width+margin-right)*(索引)
     * top = height+margin-bottom
     * 
     * 
     */

    // 瀑布流布局的特点是等宽不等高。
    // 为了让最后一行的差距最小，从第二行开始，需要将图片放在第一行最矮的图片下面，以此类推。
    // 父元素设置为相对定位，图片所在元素设置为绝对定位。然后通过设置 top 值和 left 值定位每个元素。



    window.onload = function () {
      // 获取元素
      var item = document.querySelectorAll('.box .item')
      var box = document.querySelector('.box')
      // // 获取元素的宽度
      var itemwidth = item[0].offsetWidth;
      // 页面加上上来先调用一次
      waterfall();

      function waterfall() {
        var item = document.querySelectorAll('.box .item')
        var itemwidth = item[0].offsetWidth
        var dismarright = 10;
        var heightarr = []
        for (var j = 0; j < item.length; j++) {
          // 先排号前面5个
          if (j < 5) {
            item[j].style.left = (itemwidth + dismarright) * j + 'px';
            // 将第一行的高度添加到数组里面
            heightarr.push(item[j].offsetHeight)
          } else {
            // 找数组中高度最小的值和索引
            var minheight = heightarr[0]
            var index = 0;
            for (var i = 0; i < heightarr.length; i++) {
              if (minheight > heightarr[i]) {
                minheight = heightarr[i]
                index = i;
              }
            }
            // 设置下一行的第一个盒子位置
            item[j].style.top = (heightarr[index] + dismarright) + 'px'
            item[j].style.left = item[index].offsetLeft + 'px'

            // 修改最小列的高度 
            // 自己的高度+拼接的高度+间距
            heightarr[index] += (item[j].offsetHeight + dismarright)

          }

        }

      }


      // 封装获取屏幕宽度的兼容性写法
      function getClient() {
        return {
          width: window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
          height: window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight
        }
      }

      // scrollTop兼容性处理
      function getScrollTop() {
        return window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      }

      // 懒加载效果
      // 目前我们用的是20张图片，假如一个页面中有几百张图片的时候，我们不可能等到它都加载完再显示，所有这里引入一个懒加载的概念，
      // 我们规定第20张为显示的最后一张图片，当滚动条滚动到20张的时候，应该加载下一批图片。
      // 即页面可视区高度+滚动条卷去的高度 = 第20图片的offsetTop；的时候加载下面的图片。
      window.onscroll = function () {
        // 即页面可视区高度+滚动条卷去的高度 >= 第20图片的offsetTop；的时候加载下面的图片
        if (getClient().height + getScrollTop() >= item[item.length - 1].offsetTop) {
          var datas = [
            "./img/1.jpg",
            "./img/2.jpg",
            "./img/3.jpg",
            "./img/4.jpg",
            "./img/5.jpg",
            "./img/2.jpg",
          ];
          for (var i = 0; i < datas.length; i++) {
            var div = document.createElement("div");
            div.className = "item";
            div.innerHTML = '<img src="' + datas[i] + '" alt="">';
            var imgObj = document.createElement('img')
            imgObj.src = datas[i]
            div.appendChild(imgObj)
            // 在创建一个p标签
            var pObj = document.createElement('p')
            pObj.innerHTML = "Bridge to Heaven"
            div.appendChild(pObj)
            box.appendChild(div);
            // 再创建一个div
            var divObj = document.createElement('div')
            divObj.className = "text"
            var pobj1 = document.createElement('p')
            pobj1.innerText = "A peaceful sunset view ..."
            divObj.appendChild(pobj1)
            var pobj2 = document.createElement('p')
            pobj2.innerText = "by j osborn"
            divObj.appendChild(pobj2)
           div.appendChild(divObj)
          }
          // 再次加载瀑布流
          waterfall();
        }
      }
    }


    //   <div class="text">
    //     <p>A peaceful sunset view ...</p>
    //     <p>by j osborn</p>
    //   </div>


    // 先排号第一排，前面5个
    //  页面尺寸改变的时候触发，这个需要实施改变屏幕的宽度和高度
    // window.onresize = function () {
    //   waterfall();
    // }
  </script>
</body>

</html>